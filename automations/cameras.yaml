# When motion is detected, trigger an image scan
- alias: Doods scanning
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.ffmpeg_motion
  action:
    - service: image_processing.scan
      entity_id: camera.g3_flex

# When something is detected on the camera, send an alert
- alias: Detected Camera
  trigger:
    platform: numeric_state
    entity_id: image_processing.doods_g3_flex
    # Optional
    value_template: "{{ state.attributes.total_matches }}"
  action:
    - service: telegram_bot.send_photo
      data_template:
        file: /config/www/g3_flex_latest.jpg
        caption: >-
          {%- for match in states.image_processing.doods_g3_flex.attributes.matches %}
          {{ match }} ({{ states.image_processing.doods_g3_flex.attributes.matches[match][0].score | round }}%)
          {% endfor -%}

